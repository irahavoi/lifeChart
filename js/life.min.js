(function(){var weeksInYear=52,cellOffset=11,dateFormat="MM, d yy",dateOfBirth,retireAt,currentAgeInWeeks;var currentAgeInWeeks=1560;d3.select("#vizualizeLifeChartBtn").on("click",vizualizeLifeChart);d3.select("button.close").on("click",closeErrorMsg);function vizualizeLifeChart(){if(validate()){var svg=d3.select("svg");dateOfBirth=Date.parse($("#dateOfBirth").val());currentAgeInWeeks=weeksUntilToday(dateOfBirth);retireAt=parseInt($("#retirementAge").val());d3.select("svg").attr("height",function(){return retireAt*cellOffset+"px"});var tip=d3.tip().attr('class','d3-tip').offset([-10,0]).html(function(d){return "<strong>Week:</strong> <span style='color:red'>"+(d.index+1)+"</span></strong><p><small>"+$.datepicker.formatDate(dateFormat,d.weekStartDate)+"  -  "+$.datepicker.formatDate(dateFormat,d.weekEndDate)+"</small></p>"});svg.call(tip);svg.selectAll("rect").remove();svg.selectAll("rect").data(getWeeks()).enter().append("rect").style("opacity",.6).attr("fill","gray").attr("height",cellOffset-1).attr("width",cellOffset-1).attr("x",function(d,i){var x=i%52;return x*cellOffset}).attr("y",function(d,i){return Math.floor(i/weeksInYear)*cellOffset}).on("mouseover",function(d,i){tip.show(d,i);d3.select(this).style({opacity:'0.9'})}).on("mouseout",function(d){tip.hide();d3.select(this).style({opacity:'0.6'})});d3.select("svg").selectAll("rect").transition().delay(function(d,i){return i*3}).duration(500).attr("fill",function(d,i){return(i<currentAgeInWeeks)?'red':(i==currentAgeInWeeks)?'green':'gray'});d3.select("#legend").style("display","inline-block")}}function getWeeks(){var weeks=[];for(var i=0;i<weeksInYear*retireAt;i+=1){var weekStartDate=new Date(dateOfBirth+(1000*60*60*24)*7*i);var weekEndDate=new Date(dateOfBirth+(1000*60*60*24)*7*(i+1));weeks.push({index:i,weekEndDate:weekEndDate,weekStartDate:weekStartDate})}return weeks}function weeksUntilToday(aDate){return Math.round(((new Date()-aDate)/(1000*60*60*24))/7)}function validate(){var result=true,retirementAgeInput=parseInt($("#retirementAge").val()),dateOfBirthInput=$("#dateOfBirth").val();if(!dateOfBirthInput||!retirementAgeInput){var errorTxt="Please, provide correct date of birth and planned retirement age. It's easy, you can do it!";$("#errorMsgTxt").html(errorTxt);result=false}if(retirementAgeInput>150){var errorTxt=retirementAgeInput+"? You wish :) Please, be more reasonable.";$("#errorMsgTxt").html(errorTxt);result=false}if(result){$("#errorMsg").hide()}else{$("#errorMsg").show()}return result}function closeErrorMsg(){$("#errorMsg").hide()}$(document).ready(function(){$(function(){$.material.init();$('.datepicker').datepicker({autoclose:true,dateFormat:dateFormat,format:dateFormat,maxDate:'+0m +0w',startView:2}).val()})})})();